#!/usr/bin/env processtap
# -*- python -*-

import sys, os

files = {}

# declare("int open(const char *pathname, int flags);")
# declare("int creat(const char *pathname, int flags);")
include("linux_syscalls.h")

@syscall_entry(syscall_name == "open")
def open_entry(ctx):
    files[ctx.regs.RAX] = ctx.args[0]
    print ctx.syscallname(), ctx.regs.RAX, files[ctx.regs.RAX]

